imports:
  - 'cradle/core/diff'
  - 'cradle/io/http_requests'
  - 'cradle/thinknode/types'

types:

- name: websocket_registration_message
  doc: ''
  schema:
    structure:
    - name:
        doc: ''
        schema:
          string: {}
    - session:
        doc: ''
        schema:
          named:
            app: cradle
            name: thinknode_session

- name: websocket_test_query
  doc: ''
  schema:
    structure:
    - message:
        doc: ''
        schema:
          string: {}

- name: websocket_test_response
  doc: ''
  schema:
    structure:
    - name:
        doc: ''
        schema:
          string: {}
    - message:
        doc: ''
        schema:
          string: {}

- name: websocket_cache_insert
  doc: ''
  schema:
    structure:
    - key:
        doc: ''
        schema:
          string: {}
    - value:
        doc: ''
        schema:
          string: {}

- name: websocket_cache_response
  doc: ''
  schema:
    structure:
    - key:
        doc: ''
        schema:
          string: {}
    - value:
        doc: ''
        schema:
          optional:
            string: {}

- name: output_data_encoding
  doc: ''
  schema:
    enum:
    - yaml:
        doc: 'YAML'
    - diagnostic_yaml:
        doc: 'Diagnostic YAML - This is designed to be more human-friendly and
        will omit large values (like blobs) that seem meaningless to humans.'
    - msgpack:
        doc: 'MessagePack'
    - json:
        doc: 'JSON'

- name: input_data_encoding
  doc: ''
  schema:
    enum:
    - yaml:
        doc: 'YAML'
    - msgpack:
        doc: 'MessagePack'
    - json:
        doc: 'JSON'

- name: iss_object_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - object_id:
        doc: ''
        schema:
          string: {}
    - ignore_upgrades:
        doc: ''
        schema:
          boolean: {}
    - encoding:
        doc: ''
        schema:
          named:
            app: cradle
            name: output_data_encoding

- name: iss_object_response
  doc: ''
  schema:
    structure:
    - object:
        doc: ''
        schema:
          blob: {}

- name: resolve_iss_object_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - object_id:
        doc: ''
        schema:
          string: {}
    - ignore_upgrades:
        doc: ''
        schema:
          boolean: {}

- name: resolve_iss_object_response
  doc: ''
  schema:
    structure:
    - immutable_id:
        doc: ''
        schema:
          string: {}

- name: iss_object_metadata_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - object_id:
        doc: ''
        schema:
          string: {}

- name: iss_object_metadata_response
  doc: ''
  schema:
    structure:
    - metadata:
        doc: ''
        schema:
          map:
            key_schema:
              string: {}
            value_schema:
              string: {}

- name: post_iss_object_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - schema:
        doc: ''
        schema:
          string: {}
    - encoding:
        doc: ''
        schema:
          named:
            app: cradle
            name: input_data_encoding
    - object:
        doc: ''
        schema:
          blob: {}

- name: post_iss_object_response
  doc: ''
  schema:
    structure:
    - object_id:
        doc: ''
        schema:
          string: {}

- name: copy_iss_object_request
  doc: ''
  schema:
    structure:
    - source_context_id:
        doc: ''
        schema:
          string: {}
    - destination_context_id:
        doc: ''
        schema:
          string: {}
    - object_id:
        doc: ''
        schema:
          string: {}

- name: post_calculation_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - calculation:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_request

- name: post_calculation_response
  doc: ''
  schema:
    structure:
    - calculation_id:
        doc: ''
        schema:
          string: {}

- name: calculation_search_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - calculation_id:
        doc: ''
        schema:
          string: {}
    - search_string:
        doc: ''
        schema:
          string: {}

- name: calculation_search_response
  doc: ''
  schema:
    structure:
    - matches:
        doc: ''
        schema:
          array:
            element_schema:
              string: {}

- name: resolve_meta_chain_request
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - generator:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_request

- name: resolve_meta_chain_response
  doc: ''
  schema:
    structure:
    - calculation_id:
        doc: ''
        schema:
          string: {}

- name: calculation_request_message
  doc: ''
  schema:
    structure:
    - context_id:
        doc: ''
        schema:
          string: {}
    - calculation_id:
        doc: ''
        schema:
          string: {}

- name: calculation_request_response
  doc: ''
  schema:
    structure:
    - calculation:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_request

- name: calculation_diff_request
  doc: ''
  schema:
    structure:
    - id_a:
        doc: ''
        schema:
          string: {}
    - context_a:
        doc: ''
        schema:
          string: {}
    - id_b:
        doc: ''
        schema:
          string: {}
    - context_b:
        doc: ''
        schema:
          string: {}

- name: object_node_diff
  doc: ''
  schema:
    structure:
    - service:
        doc: 'the service that this node is from (ISS or calc)'
        schema:
          named:
            app: cradle
            name: thinknode_service_id
    - path_from_root:
        doc: 'the path from the root object to the node being diffed'
        schema:
          named:
            app: cradle
            name: value_diff_path
    - id_in_a:
        doc: ID of the node in the 'a' object
        schema:
          string: {}
    - id_in_b:
        doc: ID of the node in the 'b' object
        schema:
          string: {}
    - diff:
        doc: 'diff within this node'
        schema:
          named:
            app: cradle
            name: value_diff

- name: object_tree_diff
  doc: ''
  schema:
    array:
      element_schema:
        named:
          app: cradle
          name: object_node_diff

- name: calculation_diff_response
  doc: ''
  schema:
    named:
      app: cradle
      name: object_tree_diff

- name: iss_diff_request
  doc: ''
  schema:
    structure:
    - id_a:
        doc: ''
        schema:
          string: {}
    - context_a:
        doc: ''
        schema:
          string: {}
    - id_b:
        doc: ''
        schema:
          string: {}
    - context_b:
        doc: ''
        schema:
          string: {}

- name: iss_diff_response
  doc: ''
  schema:
    named:
      app: cradle
      name: object_tree_diff

- name: client_message_content
  doc: ''
  schema:
    union:
    - kill:
        doc: ''
        schema:
          nil: {}
    - registration:
        doc: ''
        schema:
          named:
            app: cradle
            name: websocket_registration_message
    - test:
        doc: ''
        schema:
          named:
            app: cradle
            name: websocket_test_query
    - cache_insert:
        doc: ''
        schema:
          named:
            app: cradle
            name: websocket_cache_insert
    - cache_query:
        doc: ''
        schema:
          string: {}
    - iss_object:
        doc: ''
        schema:
          named:
            app: cradle
            name: iss_object_request
    - resolve_iss_object:
        doc: ''
        schema:
          named:
            app: cradle
            name: resolve_iss_object_request
    - iss_object_metadata:
        doc: ''
        schema:
          named:
            app: cradle
            name: iss_object_metadata_request
    - post_iss_object:
        doc: ''
        schema:
          named:
            app: cradle
            name: post_iss_object_request
    - copy_iss_object:
        doc: ''
        schema:
          named:
            app: cradle
            name: copy_iss_object_request
    - post_calculation:
        doc: ''
        schema:
          named:
            app: cradle
            name: post_calculation_request
    - resolve_meta_chain:
        doc: ''
        schema:
          named:
            app: cradle
            name: resolve_meta_chain_request
    - calculation_request:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_request_message
    - calculation_diff:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_diff_request
    - calculation_search:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_search_request
    - iss_diff:
        doc: ''
        schema:
          named:
            app: cradle
            name: iss_diff_request
    - perform_local_calc:
        doc: ''
        schema:
          named:
            app: cradle
            name: post_calculation_request

- name: websocket_client_message
  doc: ''
  schema:
    structure:
    - request_id:
        doc: ''
        schema:
          string: {}
    - content:
        doc: ''
        schema:
          named:
            app: cradle
            name: client_message_content

- name: http_failure_info
  doc: ''
  schema:
    structure:
    - attempted_request:
        doc: ''
        schema:
          named:
            app: cradle
            name: http_request
    - response:
        doc: ''
        schema:
          named:
            app: cradle
            name: http_response

- name: error_response
  doc: ''
  schema:
    union:
    - bad_status_code:
        doc: 'an HTTP request returned a bad status code'
        schema:
          named:
            app: cradle
            name: http_failure_info
    - unknown:
        doc: ''
        schema:
          string: {}

- name: server_message_content
  doc: ''
  schema:
    union:
    - test:
        doc: ''
        schema:
          named:
            app: cradle
            name: websocket_test_response
    - cache_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: websocket_cache_response
    - error:
        doc: ''
        schema:
          named:
            app: cradle
            name: error_response
    - iss_object_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: iss_object_response
    - resolve_iss_object_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: resolve_iss_object_response
    - iss_object_metadata_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: iss_object_metadata_response
    - post_iss_object_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: post_iss_object_response
    - copy_iss_object_response:
        doc: ''
        schema:
          nil: {}
    - post_calculation_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: post_calculation_response
    - resolve_meta_chain_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: resolve_meta_chain_response
    - calculation_request_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_request_response
    - calculation_diff_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_diff_response
    - calculation_search_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: calculation_search_response
    - iss_diff_response:
        doc: ''
        schema:
          named:
            app: cradle
            name: iss_diff_response
    - local_calc_result:
        doc: ''
        schema:
          dynamic: {}

- name: websocket_server_message
  doc: ''
  schema:
    structure:
    - request_id:
        doc: ''
        schema:
          string: {}
    - content:
        doc: ''
        schema:
          named:
            app: cradle
            name: server_message_content
